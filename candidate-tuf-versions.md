* TAP:
* Title: Managing TUF Versions
* Version: 1
* Last-Modified: 5-June-2018
* Author: Marina Moore, Justin Cappos
* Status: Draft
* Content-Type: text/markdown
* Created: 19-December-2018

# Abstract

This TAP clarifies how to manage updates to the TUF spec that include non-backwards compatible (breaking) changes. A breaking change means that a client and repository must implement the change at the same time in order to continue functioning as expected. To facilitate finding breaking changes, this TAP will define a procedure for TUF clients to ensure that their version of the TUF spec is compatible with the version of the metadata they download.

# Motivation

Various TAPs, including TAPs 3 and 8 include changes that are not backwards compatible. That means that metadata generated by a repository using a new version of the spec will be incompatible with clients using the old version of the specification. Similarly, clients using the new version will no longer be able to parse metadata from repositories using the old version of the specification. This TAP defines a procedure to ensure that clients are not missing important features that ensure the security of updates. This TAP will need to be implemented by clients before they update to a version of TUF that is not backwards compatible.

# Rationale

This TAP clarifies that spec versions should be based on [semantic versioning](https://semver.org/), with version numbers in the format MAJOR.MINOR.PATCH. This is a standard format used in other open source projects, and makes the version numbers consistent and easily understood. In addition, the consistent format makes it possible for clients to reliably compare the spec version that they are using to the spec version found in TUF metadata.

Breaking changes should only occur during a major release of the TUF spec (e.g. 1.x.x to 2.x.x). The client should check the major version in the root metadata when the root metadata is downloaded. If a new major version is found the client must update to the new spec-version before performing any software updates.

The Backwards Compatibility section of a TAP can be used to determine whether the TAP creates a breaking change. If the change is not backwards compatible, for example in TAP 3 and TAP 8, then it will be part of a new major version. These changes add features that change the way that TUF processes updates, and need to be implemented on both the client and repository to maintain security and functionality. If the change adds a new feature that is backwards compatible, for example in TAP 4 and TAP 10, it will be part of a new minor version. Patches are used to fix typos and make small changes to existing features. More details about what constitutes a major, minor, or patch change can be found at https://semver.org/.

# Specification

The root metadata already contains the TUF spec-version. After downloading and verifying the root metadata, the client shall compare the spec-version in the root metadata (repository spec-version) with the spec-version of the local client (client spec-version). The client shall then proceed as described in {Procedure}.

To allow for changes to the format of root metadata during a major update, an intermediate root metadata file will be used. This intermediate root metadata file will contain the new spec-version, but will be formatted according to the old specification. After a client updates to the new spec-version, they can download the root metadata file that follows the intermediate one, and continue with the update. If a client is multiple versions behind a repository, they will be able to access the root metadata files for each version during the root metadata download process. This will occur while the client is validating each of the root metadata files in the chain.

## Procedure

If the major versions on the client and repository do not match, the update cannot proceed until this discrepancy is resolved. If the repository spec-version is lower than the client spec-version, the client should terminate and report the mismatch to the user. The client's user may then choose to report this issue to the repository or take no action. The client will not be able to perform an update until the repository is updated or the client chooses to downgrade their TUF client. If the client spec-version is lower than the repository spec-version, the client may choose to automatically update to a new TUF client. If this option is not available, the client should report the mismatch to the user so that the user may manually update the client. Once the updated TUF client is installed, the client may proceed with the update.

If a minor version or patch of the spec-version does not match, the client should report the mismatch to the user. However, the update can proceed without further action. A client may choose to update before proceeding with the update or simply log the error. Additionally, a client may act differently for minor version changes and patches. For example, a client may choose to require manual confirmation before proceeding with a mismatched minor version, but automatically continue with a mismatched patch. In general, it is best to update to the most recent TUF client as soon as possible.

## Version Number format

TUF version numbers shall be determined based on [semantic versioning](https://semver.org/). This specification describes version numbers in the format MAJOR.MINOR.PATCH. In semantic versioning, only major changes are non-backwards compatible.

# Security Analysis

There should be minimal security impact. Ensuring that the client is up to date should improve security in the event that a security vulnerability is patched in a release of the spec.

# Backwards Compatibility

This TAP is backwards compatible, and should be implemented on all clients before any non-backwards compatible TAPs are released.

# Augmented Reference Implementation

TODO

# Copyright

This document has been placed in the public domain.
